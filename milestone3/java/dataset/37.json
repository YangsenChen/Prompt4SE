{
  "repo": "rackerlabs/blueflood",
  "path": "blueflood-core/src/main/java/com/rackspacecloud/blueflood/io/astyanax/AstyanaxWriter.java",
  "func_name": "AstyanaxWriter.insertLocatorIfDelayed",
  "original_string": "private void insertLocatorIfDelayed(IMetric metric, MutationBatch mutationBatch, Clock clock) {\n        Locator locator = metric.getLocator();\n\n        long delay = clock.now().getMillis() - metric.getCollectionTime();\n        if (delay > MAX_AGE_ALLOWED) {\n\n            //track locator for configured granularity level. to re-roll only the delayed locator's for that slot\n            int slot = DELAYED_METRICS_STORAGE_GRANULARITY.slot(metric.getCollectionTime());\n            if (!LocatorCache.getInstance().isDelayedLocatorForASlotCurrent(slot, locator)) {\n                insertDelayedLocator(DELAYED_METRICS_STORAGE_GRANULARITY, slot, locator, mutationBatch);\n                LocatorCache.getInstance().setDelayedLocatorForASlotCurrent(slot, locator);\n            }\n        }\n    }",
  "language": "java",
  "code": "private void insertLocatorIfDelayed(IMetric metric, MutationBatch mutationBatch, Clock clock) {\n        Locator locator = metric.getLocator();\n\n        long delay = clock.now().getMillis() - metric.getCollectionTime();\n        if (delay > MAX_AGE_ALLOWED) {\n\n            //track locator for configured granularity level. to re-roll only the delayed locator's for that slot\n            int slot = DELAYED_METRICS_STORAGE_GRANULARITY.slot(metric.getCollectionTime());\n            if (!LocatorCache.getInstance().isDelayedLocatorForASlotCurrent(slot, locator)) {\n                insertDelayedLocator(DELAYED_METRICS_STORAGE_GRANULARITY, slot, locator, mutationBatch);\n                LocatorCache.getInstance().setDelayedLocatorForASlotCurrent(slot, locator);\n            }\n        }\n    }",
  "code_tokens": [
    "private",
    "void",
    "insertLocatorIfDelayed",
    "(",
    "IMetric",
    "metric",
    ",",
    "MutationBatch",
    "mutationBatch",
    ",",
    "Clock",
    "clock",
    ")",
    "{",
    "Locator",
    "locator",
    "=",
    "metric",
    ".",
    "getLocator",
    "(",
    ")",
    ";",
    "long",
    "delay",
    "=",
    "clock",
    ".",
    "now",
    "(",
    ")",
    ".",
    "getMillis",
    "(",
    ")",
    "-",
    "metric",
    ".",
    "getCollectionTime",
    "(",
    ")",
    ";",
    "if",
    "(",
    "delay",
    ">",
    "MAX_AGE_ALLOWED",
    ")",
    "{",
    "//track locator for configured granularity level. to re-roll only the delayed locator's for that slot",
    "int",
    "slot",
    "=",
    "DELAYED_METRICS_STORAGE_GRANULARITY",
    ".",
    "slot",
    "(",
    "metric",
    ".",
    "getCollectionTime",
    "(",
    ")",
    ")",
    ";",
    "if",
    "(",
    "!",
    "LocatorCache",
    ".",
    "getInstance",
    "(",
    ")",
    ".",
    "isDelayedLocatorForASlotCurrent",
    "(",
    "slot",
    ",",
    "locator",
    ")",
    ")",
    "{",
    "insertDelayedLocator",
    "(",
    "DELAYED_METRICS_STORAGE_GRANULARITY",
    ",",
    "slot",
    ",",
    "locator",
    ",",
    "mutationBatch",
    ")",
    ";",
    "LocatorCache",
    ".",
    "getInstance",
    "(",
    ")",
    ".",
    "setDelayedLocatorForASlotCurrent",
    "(",
    "slot",
    ",",
    "locator",
    ")",
    ";",
    "}",
    "}",
    "}"
  ],
  "docstring": "This method inserts the locator into the metric_delayed_locator column family, if the metric is delayed.\n\n@param metric\n@param mutationBatch\n@param clock",
  "docstring_tokens": [
    "This",
    "method",
    "inserts",
    "the",
    "locator",
    "into",
    "the",
    "metric_delayed_locator",
    "column",
    "family",
    "if",
    "the",
    "metric",
    "is",
    "delayed",
    "."
  ],
  "sha": "4722a3449b1a7f8e88889ea8c340c6f24396b5b0",
  "url": "https://github.com/rackerlabs/blueflood/blob/4722a3449b1a7f8e88889ea8c340c6f24396b5b0/blueflood-core/src/main/java/com/rackspacecloud/blueflood/io/astyanax/AstyanaxWriter.java#L115-L128",
  "partition": "test"
}